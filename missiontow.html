<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø³Ø§Ø¨ Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ù‡Ù…Ø§Øª (2024) - Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f8fafc; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Fix for date inputs on mobile */
        input[type="datetime-local"] {
            direction: ltr;
            text-align: right;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-tajawal">

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        <header class="mb-8 text-center bg-white p-8 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-600 to-teal-400"></div>
            <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-3">Ø­Ø³Ø§Ø¨ Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ù‡Ù…Ø§Øª</h1>
            <p class="text-gray-500 text-lg">Ø·Ø¨Ù‚Ø§ Ù„Ù„Ù…Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ Ø±Ù‚Ù… 24-79 Ø§Ù„Ù…Ø¤Ø±Ø® ÙÙŠ 8 ÙØ¨Ø±Ø§ÙŠØ± 2024</p>
            <span class="inline-block mt-3 px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full">Ù†Ø³Ø®Ø© Ù…Ø­Ø¯Ø«Ø© 2024</span>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-8 space-y-6">
                
                <section class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex items-center gap-3 mb-4 border-b pb-3 border-gray-100">
                        <div class="bg-blue-100 p-2 rounded-lg text-blue-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-800">1. ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹ÙˆÙ† ÙˆØ§Ù„Ù…Ù†Ø·Ù‚Ø©</h2>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-600 mb-2">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„ØªØµÙ†ÙŠÙ</label>
                            <select id="employeeCategory" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                                <optgroup label="Ø´Ù…Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Ø¯ (Zone Nord)">
                                    <option value="north_1_10">Ø´Ù…Ø§Ù„: Ø§Ù„ØµÙ†Ù 01 Ø¥Ù„Ù‰ 10</option>
                                    <option value="north_11_plus">Ø´Ù…Ø§Ù„: Ø§Ù„ØµÙ†Ù 11 ÙÙ…Ø§ ÙÙˆÙ‚</option>
                                </optgroup>
                                <optgroup label="Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø¨Ù„Ø§Ø¯ (Zone Sud)">
                                    <option value="south_all">Ø¬Ù†ÙˆØ¨: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù (1 ÙÙ…Ø§ ÙÙˆÙ‚)</option>
                                </optgroup>
                                <optgroup label="Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ù„ÙŠØ§ (Fonctions SupÃ©rieures)">
                                    <option value="high_function">Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ù„ÙŠØ§ Ù„Ù„Ø¯ÙˆÙ„Ø© (Ø´Ù…Ø§Ù„ Ø£Ùˆ Ø¬Ù†ÙˆØ¨)</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                </section>

                <section class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex items-center gap-3 mb-4 border-b pb-3 border-gray-100">
                        <div class="bg-purple-100 p-2 rounded-lg text-purple-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-800">2. Ù…Ø¯Ø© Ø§Ù„Ù…Ù‡Ù…Ø©</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-600 mb-2">ØªØ§Ø±ÙŠØ® ÙˆØªÙˆÙ‚ÙŠØª Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚</label>
                            <input type="datetime-local" id="startDate" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-600 mb-2">ØªØ§Ø±ÙŠØ® ÙˆØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¹ÙˆØ¯Ø©</label>
                            <input type="datetime-local" id="endDate" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                        </div>
                    </div>
                </section>

                <section class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex items-center gap-3 mb-4 border-b pb-3 border-gray-100">
                        <div class="bg-orange-100 p-2 rounded-lg text-orange-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-800">3. Ø§Ù„Ù†Ù‚Ù„ (Ø§Ù„Ù…Ø§Ø¯Ø© 5)</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-600 mb-2">ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ù†Ù‚Ù„</label>
                            <select id="transportType" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none">
                                <option value="none">Ø¨Ø¯ÙˆÙ† ØªØ¹ÙˆÙŠØ¶ (Ù†Ù‚Ù„ Ø¹Ù…ÙˆÙ…ÙŠ/Ø³ÙŠØ§Ø±Ø© Ø®Ø¯Ù…Ø©)</option>
                                <option value="personal_car">Ø³ÙŠØ§Ø±Ø© Ø´Ø®ØµÙŠØ© (8 Ø¯Ø¬/ÙƒÙ„Ù…)</option>
                                <option value="other_moto">Ø¯Ø±Ø§Ø¬Ø© Ù†Ø§Ø±ÙŠØ© (3 Ø¯Ø¬/ÙƒÙ„Ù…)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-600 mb-2">Ø§Ù„Ù…Ø³Ø§ÙØ© (ÙƒÙ…) - Ø°Ù‡Ø§Ø¨ ÙˆØ¥ÙŠØ§Ø¨</label>
                            <input type="number" id="distance" value="0" min="0" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none">
                        </div>
                    </div>
                </section>

                <section class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <h2 class="text-lg font-bold text-gray-800 mb-4">Ø­Ø§Ù„Ø§Øª Ø®Ø§ØµØ© (Ø§Ù„Ù…Ø§Ø¯Ø© 9)</h2>
                    <div class="space-y-4">
                        <label class="flex items-center gap-3 p-3 border border-gray-100 rounded-xl hover:bg-gray-50 cursor-pointer transition">
                            <input type="checkbox" id="adminHosted" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500">
                            <span class="text-gray-700 font-medium">Ø§Ù„Ø¥ÙŠÙˆØ§Ø¡ ÙˆØ§Ù„Ø¥Ø·Ø¹Ø§Ù… ØªÙ… Ù…Ù† Ø·Ø±Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (ØªØ®ÙÙŠØ¶ Ø¥Ù„Ù‰ 25%)</span>
                        </label>
                    </div>
                </section>

                <button onclick="calculateExpenses()" class="w-full bg-gradient-to-r from-blue-700 to-blue-600 hover:from-blue-800 hover:to-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-200 transition duration-300 text-xl transform hover:-translate-y-1">
                    Ø§Ø­Ø³Ø¨ Ø§Ù„ØªØ¹ÙˆÙŠØ¶Ø§Øª ğŸ§®
                </button>
            </div>

            <div class="lg:col-span-4">
                <div class="sticky top-6 space-y-6">
                    
                    <div class="bg-gray-900 text-white p-6 rounded-2xl shadow-xl relative overflow-hidden">
                        <div class="absolute -right-6 -top-6 w-24 h-24 bg-white opacity-10 rounded-full blur-xl"></div>
                        <h3 class="text-gray-400 text-sm font-medium mb-1">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚</h3>
                        <div class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-300" id="grandTotal">0.00 Ø¯Ø¬</div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-800 mb-5 border-b pb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between items-center text-sm group">
                                <div class="flex items-center gap-2 text-gray-600">
                                    <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                                    <span>ÙˆØ¬Ø¨Ø§Øª Ø§Ù„ØºØ¯Ø§Ø¡ (11h-14h):</span>
                                </div>
                                <span class="font-bold bg-gray-100 px-2 py-0.5 rounded text-gray-800" id="lunchCount">0</span>
                            </div>
                            
                            <div class="flex justify-between items-center text-sm group">
                                <div class="flex items-center gap-2 text-gray-600">
                                    <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                                    <span>ÙˆØ¬Ø¨Ø§Øª Ø§Ù„Ø¹Ø´Ø§Ø¡ (18h-21h):</span>
                                </div>
                                <span class="font-bold bg-gray-100 px-2 py-0.5 rounded text-gray-800" id="dinnerCount">0</span>
                            </div>

                            <div class="flex justify-between items-center text-sm group">
                                <div class="flex items-center gap-2 text-gray-600">
                                    <span class="w-2 h-2 rounded-full bg-purple-500"></span>
                                    <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù„ÙŠØ§Ù„ÙŠ (00h-06h):</span>
                                </div>
                                <span class="font-bold bg-gray-100 px-2 py-0.5 rounded text-gray-800" id="nightCount">0</span>
                            </div>

                            <hr class="border-dashed border-gray-200 my-4">

                            <div class="space-y-2">
                                <div class="flex justify-between text-blue-700 text-sm">
                                    <span>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¥Ø·Ø¹Ø§Ù…:</span>
                                    <span class="font-bold" id="totalFood">0.00 Ø¯Ø¬</span>
                                </div>
                                <div class="flex justify-between text-purple-700 text-sm">
                                    <span>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨ÙŠØª:</span>
                                    <span class="font-bold" id="totalLodging">0.00 Ø¯Ø¬</span>
                                </div>
                                <div class="flex justify-between text-orange-700 text-sm">
                                    <span>ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ù†Ù‚Ù„:</span>
                                    <span class="font-bold" id="totalTransport">0.00 Ø¯Ø¬</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        
        <footer class="mt-12 text-center text-gray-400 text-sm py-6 border-t border-gray-200">
            <p>&copy; 2024 - ØªØ·Ø¨ÙŠÙ‚ Ø­Ø³Ø§Ø¨ Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ù‡Ù…Ø§Øª (Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±)</p>
            <p class="mt-1 text-xs">ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙˆÙÙ‚ Ø§Ù„Ø¬Ø±ÙŠØ¯Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ø±Ù‚Ù… 11 (14 ÙØ¨Ø±Ø§ÙŠØ± 2024)</p>
        </footer>
    </div>

    <script>
        /**
         * CONFIGURATION PARAMETERS (Decree 24-79 / Feb 2024)
         */
        const CONFIG = {
            rates: {
                north_1_10:     { meal: 600, lodging: 2400 }, // Cat 1-10
                north_11_plus:  { meal: 800, lodging: 3200 }, // Cat 11+
                south_all:      { meal: 1000, lodging: 4000 }, // Cat 1+
                high_function:  { meal: 1600, lodging: 6400 }
            },
            transport: {
                personal_car: 8.0,  
                other_moto: 3.0,    
                none: 0
            },
            reductions: {
                hosted: 0.25,  
                full: 1.0      
            }
        };

        function calculateExpenses() {
            try {
                // 1. Get Inputs
                const category = document.getElementById('employeeCategory').value;
                const startVal = document.getElementById('startDate').value;
                const endVal = document.getElementById('endDate').value;
                const distance = parseFloat(document.getElementById('distance').value) || 0;
                const transportType = document.getElementById('transportType').value;
                const isAdminHosted = document.getElementById('adminHosted').checked;

                // 2. Validate
                if (!startVal || !endVal) {
                    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹ÙˆØ¯Ø©");
                    return;
                }
                const startDate = new Date(startVal);
                const endDate = new Date(endVal);

                if (endDate <= startDate) {
                    alert("Ø®Ø·Ø£: ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹ÙˆØ¯Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚!");
                    return;
                }

                // 3. Count
                const counts = countOccurrences(startDate, endDate);

                // 4. Calculate
                const rateData = CONFIG.rates[category];
                const coefficient = isAdminHosted ? CONFIG.reductions.hosted : CONFIG.reductions.full;

                const mealCost = rateData.meal * coefficient;
                const lodgingCost = rateData.lodging * coefficient;

                const totalFood = (counts.lunches + counts.dinners) * mealCost;
                const totalLodging = counts.nights * lodgingCost;

                let totalTransport = 0;
                if (transportType !== 'none') {
                    totalTransport = distance * CONFIG.transport[transportType];
                }

                const grandTotal = totalFood + totalLodging + totalTransport;

                // 5. Update UI
                updateUI(counts, totalFood, totalLodging, totalTransport, grandTotal);
                
                // Success feedback
                console.log("Calculation successful:", grandTotal);

            } catch (e) {
                console.error(e);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.");
            }
        }

        function countOccurrences(start, end) {
            let lunches = 0;
            let dinners = 0;
            let nights = 0;

            let ptr = new Date(start);
            
            // Loop day by day
            while(ptr < end) {
                // Check Lunch (12:00)
                let lunchTime = new Date(ptr); lunchTime.setHours(12,0,0,0);
                if (ptr <= lunchTime && end > lunchTime) lunches++;

                // Check Dinner (19:00)
                let dinnerTime = new Date(ptr); dinnerTime.setHours(19,0,0,0);
                if (ptr <= dinnerTime && end > dinnerTime) dinners++;

                // Check Night (00:00 of Next Day)
                let nightTime = new Date(ptr); 
                nightTime.setDate(nightTime.getDate() + 1);
                nightTime.setHours(0,0,0,0);
                
                if (ptr <= nightTime && end > nightTime) nights++;

                // Move to next day
                ptr.setDate(ptr.getDate() + 1);
                ptr.setHours(0,1,0,0);
            }

            return { lunches, dinners, nights };
        }

        function updateUI(counts, food, lodging, transport, total) {
            document.getElementById('lunchCount').innerText = counts.lunches;
            document.getElementById('dinnerCount').innerText = counts.dinners;
            document.getElementById('nightCount').innerText = counts.nights;

            const fmt = (n) => n.toLocaleString('fr-DZ', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' Ø¯Ø¬';
            
            document.getElementById('totalFood').innerText = fmt(food);
            document.getElementById('totalLodging').innerText = fmt(lodging);
            document.getElementById('totalTransport').innerText = fmt(transport);
            document.getElementById('grandTotal').innerText = fmt(total);
        }

        // Initialize Dates on Load
        window.onload = function() {
            const now = new Date();
            const start = new Date(now); start.setHours(8,0,0,0);
            const end = new Date(now); end.setDate(end.getDate()+1); end.setHours(16,0,0,0);
            
            const toLocalISO = (d) => {
                const offset = d.getTimezoneOffset() * 60000;
                return new Date(d.getTime() - offset).toISOString().slice(0, 16);
            };

            document.getElementById('startDate').value = toLocalISO(start);
            document.getElementById('endDate').value = toLocalISO(end);
        };
    </script>
</body>
</html>
